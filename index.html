<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>a.lazyflower ä¸€æœµæ‡¶æ‡¶èŠ±ğŸŒ¸</title>
    
    <!-- GoatCounter è¨ªå®¢çµ±è¨ˆ -->
    <script data-goatcounter="https://lazyflower.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <script async src="//www.instagram.com/embed.js"></script>
    <style>
        body { 
            font-family: 'Noto Sans TC', 'Inter', sans-serif; 
            background-color: #fcfcfc; 
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        * {
            -webkit-touch-callout: none;
        }
        .text-pink{ color: #ffa4d1; }
        .bg-blue{ background-color: #32a9df; }
        .bg-blue:hover{ background-color: rgb(27, 128, 175); }
        .post-card { 
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out; 
            background-color: #fff; 
            border: 1px solid #f0f0f0;
            display: flex;
            flex-direction: row;
            height: 380px;
            align-items: stretch;
        }
        .post-card:hover { transform: translateY(-5px) rotate(0.5deg); box-shadow: 0 15px 25px -5px rgba(236, 72, 153, 0.2); }
        .post-card-image { 
            flex: 0 0 320px; 
            max-width: 320px; 
            min-width: 320px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .post-card-content { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            min-width: 0;
        }
        .post-content-text { 
            max-height: 120px; 
            overflow: hidden; 
            transition: max-height 0.3s ease;
            position: relative;
        }
        .post-content-text.expanded { max-height: 500px; overflow-y: auto; }
        .expand-btn { cursor: pointer; color: #32a9df; font-size: 0.875rem; margin-top: 0.5rem; }
        .expand-btn:hover { text-decoration: underline; }
        #sidebar { 
            width: 16rem; 
            flex-shrink: 0;
            transition: transform 0.3s ease-in-out; 
            max-height: calc(100vh - 8rem); 
            overflow-y: auto; 
        }
        #sidebar::-webkit-scrollbar { width: 6px; }
        #sidebar::-webkit-scrollbar-thumb { background-color: #f9a8d4; border-radius: 3px; }
        .ig-embed-container { 
            width: 100%; 
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .ig-embed-container .instagram-media { 
            width: 100% !important; 
            max-width: 100% !important; 
            min-width: 0 !important; 
            margin: 0 auto !important;
        }
        #back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: #32a9df;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(50, 169, 223, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        #back-to-top:hover {
            background-color: rgb(27, 128, 175);
            transform: translateY(-5px);
        }
        #back-to-top.show { display: flex; }
        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-modal:hover { color: #000; }
        .max-w-7xl.mx-auto.flex {
            align-items: flex-start;
        }
        main.flex-1 {
            min-width: 0;
            overflow-x: hidden;
        }
        @media (max-width: 768px) {
            .post-card {
                height: 280px;
            }
            .post-card-image { 
                flex: 0 0 200px; 
                max-width: 200px; 
                min-width: 200px;
            }
            .post-content-text { 
                max-height: 80px;
            }
            header .max-w-7xl { padding: 0.75rem 1rem !important; }
            header h1 { font-size: 1rem !important; line-height: 1.4 !important; }
            .lg\:hidden.border-t { padding: 0.5rem 1rem !important; }
        }
        @media (max-width: 480px) {
            .post-card {
                height: 220px;
            }
            .post-card-image { 
                flex: 0 0 150px; 
                max-width: 150px; 
                min-width: 150px;
            }
            .post-content-text { 
                max-height: 60px;
                font-size: 0.75rem;
            }
            .post-card-content .px-4 {
                padding-left: 0.75rem;
                padding-right: 0.75rem;
            }
            .post-card-content .p-4 {
                padding: 0.75rem;
            }
        }
    </style>
</head>
<body class="text-slate-800">

<header class="sticky top-0 bg-white shadow-xl z-20">
    <div class="max-w-7xl mx-auto p-4 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
        <div class="flex flex-col sm:flex-row items-center gap-4 w-full sm:w-auto">
            <h1 class="text-lg sm:text-xl font-extrabold text-pink text-center sm:text-left">
                a.lazyflower<br class="sm:hidden">ä¸€æœµæ‡¶æ‡¶èŠ±ğŸŒ¸<br class="hidden sm:inline"> å°ä¸­ï½œç¾é£Ÿï½œç”Ÿæ´»
            </h1>
        </div>
        <div class="w-full sm:w-96 relative">
            <input type="text" id="search-input" placeholder="ğŸ” æœå°‹å€åŸŸã€åº—åæˆ–é—œéµå­—..." 
                class="w-full py-2.5 pl-5 pr-10 border-2 border-blue-300 rounded-full shadow-md focus:outline-none focus:ring-4 focus:ring-blue-100 transition duration-200"
                oninput="filterPosts(this.value)">
        </div>
    </div>

    <!-- æ‰‹æ©Ÿç‰ˆåˆ†é¡å°è¦½ -->
    <div class="lg:hidden border-t border-slate-200 bg-white">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <h3 class="text-sm font-bold mb-2 text-blue-500">åˆ†é¡å°è¦½</h3>
            <div class="overflow-x-auto">
                <ul id="mobile-nav-list" class="flex space-x-3 pb-2"></ul>
            </div>
        </div>
    </div>
</header>

<div class="max-w-7xl mx-auto flex">
    <nav id="sidebar" class="hidden lg:block sticky top-32 py-8 pr-6 border-r border-slate-100">
        <!-- å´é‚Šæ¬„è³‡è¨Šå€ -->
        <div class="mt-8 p-4 bg-gradient-to-br from-pink-50 to-blue-50 rounded-xl">
            <h4 class="font-bold text-slate-700 mb-3">ğŸ‘‹ é—œæ–¼æˆ‘</h4>
            <p class="text-sm text-slate-600 mb-3">å–œæ„›ç™¼æ˜ç”Ÿæ´»ä¸­çš„ç¾å¥½ğŸ™‹â€â™€ï¸<br>
                å°é³¥èƒƒâ—èèŸ»äººâ—æŒ‘é£Ÿé¬¼ğŸ‘»<br> é£Ÿè¨˜ä¸»è§€ç´€éŒ„ğŸ˜‰<br>
                ğŸ“®äº’æƒ /åˆä½œé‚€ç´„æ­¡è¿ç§è¨Š<br>
                âš ï¸æœªç¶“åŒæ„å‹¿è½‰è¼‰åœ–æ–‡
            </p>
            <a href="https://www.instagram.com/a.lazyflower" target="_blank" class="block w-full text-center py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm rounded-lg hover:opacity-90 transition mb-2">
                IG: @a.lazyflower
            </a>
            <div class="text-center text-xs text-slate-400 mt-3 pt-3 border-t border-slate-200">
                ç¶²ç«™ç€è¦½æ¬¡æ•¸: <span id="visit-count" class="font-bold text-blue-600">è¼‰å…¥ä¸­...</span>
            </div>
        </div>

        <h3 class="text-lg font-bold mb-4 text-blue-500 border-b pb-2 border-blue-100">åˆ†é¡å°è¦½</h3>
        <ul id="city-nav-list" class="space-y-2"></ul>
        
    </nav>

    <main class="flex-1 p-4 sm:p-6 lg:p-10">
        <!-- è‡ªæˆ‘ä»‹ç´¹å€å¡Šï¼ˆæ‰‹æ©Ÿç‰ˆï¼‰ -->
        <div class="lg:hidden mb-8 p-6 bg-gradient-to-br from-pink-50 to-blue-50 rounded-xl shadow-md">
            <h2 class="text-xl font-bold text-pink mb-3">ğŸ‘‹ é—œæ–¼æˆ‘</h2>
            <p class="text-slate-700 mb-3">å–œæ„›ç™¼æ˜ç”Ÿæ´»ä¸­çš„ç¾å¥½ğŸ™‹â€â™€ï¸<br>
                å°é³¥èƒƒâ—èèŸ»äººâ—æŒ‘é£Ÿé¬¼ğŸ‘»<br> é£Ÿè¨˜ä¸»è§€ç´€éŒ„ğŸ˜‰<br>
                ğŸ“®äº’æƒ /åˆä½œé‚€ç´„æ­¡è¿ç§è¨Š<br>
                âš ï¸æœªç¶“åŒæ„å‹¿è½‰è¼‰åœ–æ–‡
            </p>
            <div class="flex gap-2 mb-3">
                <a href="https://www.instagram.com/a.lazyflower" target="_blank" class="flex-1 text-center py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-sm rounded-lg hover:opacity-90 transition">
                    IG: @a.lazyflower
                </a>
            </div>
            <div class="text-center text-sm text-slate-500 pt-3 border-t border-slate-200">
                ç¶²ç«™ç€è¦½æ¬¡æ•¸: <span id="visit-count-mobile" class="font-bold text-blue-600">è¼‰å…¥ä¸­...</span>
            </div>
        </div>

        <div id="posts-container" class="space-y-8"></div>
        <div id="no-results" class="text-center py-20 hidden bg-slate-50 rounded-xl mt-10">
            <p class="text-2xl font-semibold text-slate-500 mb-2">ğŸ˜… æ‰¾ä¸åˆ°çµæœ</p>
            <p class="text-lg text-slate-400">æŠ±æ­‰ï¼æ‰¾ä¸åˆ°ç¬¦åˆ <span id="search-query-display" class="font-bold text-pink"></span> çš„é£Ÿè¨˜ã€‚</p>
            <p class="mt-4 text-slate-400">è«‹å˜—è©¦æ›´å¯¬æ³›çš„é—œéµå­—æˆ–æª¢æŸ¥æ‹¼å¯«ã€‚</p>
        </div>
    </main>
</div>

<!-- è¿”å›é ‚éƒ¨æŒ‰éˆ• -->
<div id="back-to-top" onclick="scrollToTop()">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
    </svg>
</div>

<footer class="bg-slate-100 mt-12 py-8 text-center text-sm text-slate-500">
    <p>Copyright Â© 2025 a.lazyflower ä¸€æœµæ‡¶æ‡¶èŠ±ğŸŒ¸. All rights reserved.</p>
</footer>

<script type="module">
    import { IG_POSTS } from './posts.js';

    const POSTS_PER_LOAD = 6;
    const REGIONS = [
        'å°åŒ— Taipei','æ–°åŒ— New Taipei','æ¡ƒåœ’ Taoyuan','è‹—æ — Miaoli','å°ä¸­ Taichung','å½°åŒ– Changhua',
        'å—æŠ• Nantou','é›²æ— Yunlin','å˜‰ç¾© Chiayi','å°å— Tainan','é«˜é›„ Kaohsiung','å±æ± Pingtung',
        'å®œè˜­ Yilan','èŠ±è“® Hualien','å°æ± Taitung','æ—¥æœ¬ Japan','é–‹ç®± Unboxing','æ—…éŠ Travel'
    ];

    const postsContainer = document.getElementById('posts-container');
    const noResults = document.getElementById('no-results');
    const searchQueryDisplay = document.getElementById('search-query-display');
    const cityNavList = document.getElementById('city-nav-list');
    const mobileNavList = document.getElementById('mobile-nav-list');
    let currentPostCounts = {};
    let visiblePostsByRegion = {};

    function formatDate(dateStr){
        const date = new Date(dateStr);
        return `${date.getFullYear()}å¹´${String(date.getMonth()+1).padStart(2,'0')}æœˆ${String(date.getDate()).padStart(2,'0')}æ—¥`;
    }

    function createPostCard(post, index){
        let cleanPermalink = post.permalink.split('?')[0].split('#')[0];
        if(!cleanPermalink.endsWith('/')) cleanPermalink += '/';
        const postId = `post-${Date.now()}-${index}`;
        return `
        <div class="post-card rounded-xl shadow-md bg-white overflow-hidden">
            <div class="post-card-image ig-embed-container">
                <blockquote class="instagram-media" data-instgrm-permalink="${cleanPermalink}" data-instgrm-version="14"></blockquote>
            </div>
            <div class="post-card-content">
                <div class="px-4 pt-3 pb-2">
                    <a href="${cleanPermalink}" target="_blank" class="inline-flex items-center gap-2 text-xs text-slate-500 hover:text-blue-600 transition duration-150">
                        ğŸ“¸ åœ¨ Instagram æŸ¥çœ‹é€™å‰‡è²¼æ–‡
                    </a>
                </div>
                <div class="p-4 flex-1 overflow-hidden">
                    <div id="${postId}" class="post-content-text">
                        <p class="text-slate-700 text-sm leading-relaxed whitespace-pre-line">${post.content}</p>
                    </div>
                    <div class="expand-btn" onclick="toggleExpand('${postId}')">
                        <span id="${postId}-btn">ğŸ“– å±•é–‹å…¨æ–‡</span>
                    </div>
                    ${post.map ? `<div class="mt-3"><a href="${post.map}" target="_blank" class="inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-700">ğŸ“ é–‹å•Ÿåœ°åœ–</a></div>` : ''}
                    <div class="flex justify-between items-center mt-3 pt-3 border-t border-slate-100">
                        <span class="text-xs text-slate-500">ğŸ“… ${formatDate(post.date)}</span>
                        <span class="inline-block text-xs font-semibold text-white bg-blue-600 px-3 py-1 rounded-full">${post.region}</span>
                    </div>
                </div>
            </div>
        </div>`;
    }

    function parseDate(dateStr) {
        // å°‡ 'YYYY-MM-DD' è§£ææˆ Date ç‰©ä»¶
        const [year, month, day] = dateStr.split('-').map(Number);
        return new Date(year, month-1, day);
    }

    function renderPosts(regionsToRender, isSearch=false, filteredPosts=[]) {
        postsContainer.innerHTML = '';
        currentPostCounts = {};
        if(regionsToRender.length===0 && document.getElementById('search-input').value.trim()!==''){
            noResults.classList.remove('hidden'); 
            return;
        } else noResults.classList.add('hidden');

        const sortedPosts = [...IG_POSTS].sort((a,b) => parseDate(b.date) - parseDate(a.date));
        const groupedPosts = sortedPosts.reduce((acc, post)=>{
            if(!acc[post.region]) acc[post.region]=[];
            acc[post.region].push(post);
            return acc;
        }, {});

        regionsToRender.forEach(city=>{
            // æœå°‹æ™‚ä½¿ç”¨ filteredPostsï¼Œå¦å‰‡ä½¿ç”¨ groupedPosts
            const cityPosts = isSearch 
                ? filteredPosts.filter(p => p.region === city) 
                : groupedPosts[city] || [];

            visiblePostsByRegion[city] = cityPosts; // <-- å„²å­˜é€™å€‹å€åŸŸæ–‡ç« 

            const safeCityId = city.replace(/\s+/g,'-');
            const initialCount = isSearch ? cityPosts.length : Math.min(cityPosts.length, POSTS_PER_LOAD);
            const hasMore = cityPosts.length > initialCount;

            const citySection = document.createElement('section');
            citySection.id = safeCityId;
            citySection.className = 'city-section pt-10';
            citySection.innerHTML = `
                <h3 class="text-2xl sm:text-3xl font-extrabold text-pink mb-6 flex items-center border-b-2 border-pink pb-2">
                    ğŸ“Œ ${city} <span class="text-sm sm:text-lg font-normal text-slate-500 ml-3">${cityPosts.length>0 ? `(${cityPosts.length} ç¯‡)`:'(å°šç„¡è²¼æ–‡)'}</span>
                </h3>
                <div id="grid-${safeCityId}" class="flex flex-col gap-6"></div>
                <div class="text-center mt-8">
                    ${cityPosts.length>0 && !isSearch ? `<button id="load-more-${safeCityId}" onclick="loadMore('${city}')" class="font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 bg-blue hover:bg-blue text-white">${hasMore?`è¼‰å…¥æ›´å¤š (ç›®å‰å·²é¡¯ç¤º ${initialCount}/${cityPosts.length} ç¯‡)`:`å·²é¡¯ç¤ºå…¨éƒ¨ ${cityPosts.length} ç¯‡`}</button>` : ''}
                </div>
            `;
            postsContainer.appendChild(citySection);
            const gridContainer = citySection.querySelector('.flex');
            for(let i=0; i<initialCount; i++) gridContainer.insertAdjacentHTML('beforeend', createPostCard(cityPosts[i], i));
            currentPostCounts[city] = initialCount;
        });

        if(window.instgrm) window.instgrm.Embeds.process();
    }

    window.filterPosts = function(query){
        const q = query.trim().toLowerCase();
        searchQueryDisplay.textContent = q;
        if(!q) return renderPosts(REGIONS);

        const filteredPosts = IG_POSTS.filter(p=>p.region.toLowerCase().includes(q) || p.content.toLowerCase().includes(q));
        const regionsToRender = [...new Set(filteredPosts.map(p=>p.region))];
        renderPosts(regionsToRender, true, filteredPosts); // å‚³å…¥ filteredPosts
    }

    window.loadMore = function(city){
        const cityPosts = visiblePostsByRegion[city] || [];
        const currentCount = currentPostCounts[city]||0;
        const gridContainer = document.getElementById(`grid-${city.replace(/\s/g,'-')}`);
        const loadMoreButton = document.getElementById(`load-more-${city.replace(/\s/g,'-')}`);
        if(!gridContainer||!loadMoreButton) return;

        const nextCount = Math.min(currentCount+POSTS_PER_LOAD, cityPosts.length);
        for(let i=currentCount; i<nextCount; i++){
            gridContainer.insertAdjacentHTML('beforeend', createPostCard(cityPosts[i], i));
        }
        currentPostCounts[city] = nextCount;

        if(nextCount >= cityPosts.length){
            loadMoreButton.textContent=`å·²é¡¯ç¤ºå…¨éƒ¨ ${cityPosts.length} ç¯‡è²¼æ–‡`;
            loadMoreButton.disabled = true;
            loadMoreButton.classList.add('bg-gray-300','cursor-not-allowed');
            loadMoreButton.classList.remove('bg-blue','hover:bg-blue');
        } else {
            loadMoreButton.textContent=`è¼‰å…¥æ›´å¤š (ç›®å‰å·²é¡¯ç¤º ${nextCount}/${cityPosts.length} ç¯‡)`;
        }

        if(window.instgrm) window.instgrm.Embeds.process();
    }

    function renderNavLists() {
        cityNavList.innerHTML = '';
        mobileNavList.innerHTML = '';
        REGIONS.forEach(region => {
            const liDesktop = document.createElement('li');
            liDesktop.innerHTML = `<a href="#${region.replace(/\s+/g,'-')}" class="block px-3 py-1 rounded hover:bg-blue-50 text-blue-600">
                ${region} (${IG_POSTS.filter(p => p.region === region).length})
            </a>`;
            cityNavList.appendChild(liDesktop);

            const liMobile = document.createElement('li');
            liMobile.innerHTML = `<a href="#${region.replace(/\s+/g,'-')}" class="px-3 py-1 rounded bg-blue-50 text-blue-600 whitespace-nowrap hover:bg-blue-100">${region}</a>`;
            mobileNavList.appendChild(liMobile);
        });
    }

    // å±•é–‹/æ”¶åˆåŠŸèƒ½
    window.toggleExpand = function(postId) {
        const element = document.getElementById(postId);
        const btn = document.getElementById(postId + '-btn');
        if (element.classList.contains('expanded')) {
            element.classList.remove('expanded');
            btn.textContent = 'ğŸ“– å±•é–‹å…¨æ–‡';
        } else {
            element.classList.add('expanded');
            btn.textContent = 'ğŸ“– æ”¶åˆ';
        }
    }

    // è¿”å›é ‚éƒ¨æŒ‰éˆ•
    window.scrollToTop = function() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ç›£è½æ»¾å‹•é¡¯ç¤ºè¿”å›é ‚éƒ¨æŒ‰éˆ•
    window.addEventListener('scroll', function() {
        const backToTop = document.getElementById('back-to-top');
        if (window.pageYOffset > 300) {
            backToTop.classList.add('show');
        } else {
            backToTop.classList.remove('show');
        }
    });

    // GoatCounter ç€è¦½æ¬¡æ•¸åŠŸèƒ½ - ä½¿ç”¨åœ–ç‰‡è¨ˆæ•¸å™¨
    function updateVisitCount() {
        const visitCountEl = document.getElementById('visit-count');
        const mobileCountEl = document.getElementById('visit-count-mobile');
        
        // ä½¿ç”¨ GoatCounter çš„ SVG åœ–ç‰‡è¨ˆæ•¸å™¨ï¼ˆç„¡ CORS å•é¡Œï¼‰
        const counterImg = '<img src="https://lazyflower.goatcounter.com/counter/TOTAL.svg" alt="ç€è¦½æ¬¡æ•¸" style="display:inline-block; vertical-align:middle; max-height:1.2em;">';
        
        if (visitCountEl) visitCountEl.innerHTML = counterImg;
        if (mobileCountEl) mobileCountEl.innerHTML = counterImg;
    }

    // ç¦æ­¢å³éµé¸å–®
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
    });

    // ç¦æ­¢ç‰¹å®šå¿«æ·éµ
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey && (e.key === 'c' || e.key === 'a' || e.key === 'u')) || 
            (e.ctrlKey && e.shiftKey && e.key === 'i')) {
            e.preventDefault();
        }
    });

    document.addEventListener('DOMContentLoaded',()=>{
        renderNavLists();
        renderPosts(REGIONS);
        updateVisitCount();
    });
</script>

</body>
</html>
