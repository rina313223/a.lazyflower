<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>a.lazyflower ä¸€æœµæ‡¶æ‡¶èŠ±ğŸŒ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <script async src="//www.instagram.com/embed.js"></script>
    <style>
        body { font-family: 'Noto Sans TC', 'Inter', sans-serif; background-color: #fcfcfc; }
        .text-pink{ color: #ffa4d1; }
        .bg-blue{ background-color: #32a9df; }
        .bg-blue:hover{ background-color: rgb(27, 128, 175); }
        .post-card { transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out; background-color: #fff; border: 1px solid #f0f0f0; }
        .post-card:hover { transform: translateY(-5px) rotate(0.5deg); box-shadow: 0 15px 25px -5px rgba(236, 72, 153, 0.2); }
        #sidebar { width: 16rem; transition: transform 0.3s ease-in-out; max-height: calc(100vh - 8rem); overflow-y: auto; }
        #sidebar::-webkit-scrollbar { width: 6px; }
        #sidebar::-webkit-scrollbar-thumb { background-color: #f9a8d4; border-radius: 3px; }
        .ig-embed-container { width: 100%; min-width: 0; overflow: hidden; }
        .ig-embed-container .instagram-media { width: 100% !important; max-width: 100% !important; min-width: 0 !important; margin: 0 !important; padding: 0 !important; }
    </style>
</head>
<body class="text-slate-800">

<header class="sticky top-0 bg-white shadow-xl z-20">
    <div class="max-w-7xl mx-auto p-4 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
        <h1 class="text-xl font-extrabold text-pink flex items-center">
            a.lazyflower<br>ä¸€æœµæ‡¶æ‡¶èŠ±ğŸŒ¸ å°ä¸­ï½œç¾é£Ÿï½œç”Ÿæ´»
        </h1>
        <div class="w-full sm:w-96 relative">
            <input type="text" id="search-input" placeholder="ğŸ” æœå°‹å€åŸŸã€åº—åæˆ–é—œéµå­—..." 
                class="w-full py-2.5 pl-5 pr-10 border-2 border-blue-300 rounded-full shadow-md focus:outline-none focus:ring-4 focus:ring-blue-100 transition duration-200"
                oninput="filterPosts(this.value)">
        </div>
    </div>

    <!-- æ‰‹æ©Ÿç‰ˆåˆ†é¡å°è¦½ -->
    <div class="lg:hidden border-t border-slate-200 bg-white">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <h3 class="text-sm font-bold mb-2 text-blue-500">åˆ†é¡å°è¦½</h3>
            <div class="overflow-x-auto">
                <ul id="mobile-nav-list" class="flex space-x-3 pb-2"></ul>
            </div>
        </div>
    </div>
</header>

<div class="max-w-7xl mx-auto flex">
    <nav id="sidebar" class="hidden lg:block sticky top-32 py-8 pr-6 border-r border-slate-100">
        <h3 class="text-lg font-bold mb-4 text-blue-500 border-b pb-2 border-blue-100">åˆ†é¡å°è¦½</h3>
        <ul id="city-nav-list" class="space-y-2"></ul>
    </nav>

    <main class="flex-1 p-4 sm:p-6 lg:p-10">
        <div id="posts-container" class="space-y-16"></div>
        <div id="no-results" class="text-center py-20 hidden bg-slate-50 rounded-xl mt-10">
            <p class="text-2xl font-semibold text-slate-500 mb-2">ğŸ˜… æ‰¾ä¸åˆ°çµæœ</p>
            <p class="text-lg text-slate-400">æŠ±æ­‰ï¼æ‰¾ä¸åˆ°ç¬¦åˆ <span id="search-query-display" class="font-bold text-pink"></span> çš„é£Ÿè¨˜ã€‚</p>
            <p class="mt-4 text-slate-400">è«‹å˜—è©¦æ›´å¯¬æ³›çš„é—œéµå­—æˆ–æª¢æŸ¥æ‹¼å¯«ã€‚</p>
        </div>
    </main>
</div>

<footer class="bg-slate-100 mt-12 py-8 text-center text-sm text-slate-500">
    <p>Copyright Â© 2025 a.lazyflower ä¸€æœµæ‡¶æ‡¶èŠ±ğŸŒ¸. All rights reserved.</p>
</footer>

<script type="module">
    import { IG_POSTS } from './posts.js';

    const POSTS_PER_LOAD = 6;
    const REGIONS = [
        'å°åŒ— Taipei','æ–°åŒ— New Taipei','æ¡ƒåœ’ Taoyuan','è‹—æ — Miaoli','å°ä¸­ Taichung','å½°åŒ– Changhua',
        'å—æŠ• Nantou','é›²æ— Yunlin','å˜‰ç¾© Chiayi','å°å— Tainan','é«˜é›„ Kaohsiung','å±æ± Pingtung',
        'å®œè˜­ Yilan','èŠ±è“® Hualien','å°æ± Taitung','æ—¥æœ¬ Japan','é–‹ç®± Unboxing','æ—…éŠ Travel'
    ];

    const postsContainer = document.getElementById('posts-container');
    const noResults = document.getElementById('no-results');
    const searchQueryDisplay = document.getElementById('search-query-display');
    const cityNavList = document.getElementById('city-nav-list');
    const mobileNavList = document.getElementById('mobile-nav-list');
    let currentPostCounts = {};

    function formatDate(dateStr){
        const date = new Date(dateStr);
        return `${date.getFullYear()}å¹´${String(date.getMonth()+1).padStart(2,'0')}æœˆ${String(date.getDate()).padStart(2,'0')}æ—¥`;
    }

    function createPostCard(post){
        let cleanPermalink = post.permalink.split('?')[0].split('#')[0];
        if(!cleanPermalink.endsWith('/')) cleanPermalink += '/';
        return `
        <div class="post-card rounded-xl shadow-md bg-white overflow-hidden">
            <div class="w-full ig-embed-container">
                <blockquote class="instagram-media" data-instgrm-permalink="${cleanPermalink}" data-instgrm-version="14"></blockquote>
            </div>
            <div class="px-4 pb-2">
                <a href="${cleanPermalink}" target="_blank" class="inline-flex items-center gap-2 text-xs text-slate-500 hover:text-blue-600 transition duration-150">
                    åœ¨ Instagram æŸ¥çœ‹é€™å‰‡è²¼æ–‡
                </a>
            </div>
            <div class="p-4">
                <p class="text-slate-700 text-sm mb-3 leading-relaxed whitespace-pre-line">${post.content}</p>
                ${post.map ? `<div class="mb-3"><a href="${post.map}" target="_blank" class="inline-flex items-center gap-2 text-sm font-medium text-blue-600 hover:text-blue-700">é–‹å•Ÿåœ°åœ–</a></div>` : ''}
                <div class="flex justify-between items-center">
                    <span class="text-xs text-slate-500">${formatDate(post.date)}</span>
                    <span class="inline-block text-xs font-semibold text-white bg-blue-600 px-3 py-1 rounded-full">${post.region}</span>
                </div>
            </div>
        </div>`;
    }

    function renderPosts(regionsToRender, isSearch=false, filteredPosts=[]) {
        postsContainer.innerHTML = '';
        currentPostCounts = {};
        if(regionsToRender.length===0 && document.getElementById('search-input').value.trim()!==''){
            noResults.classList.remove('hidden'); 
            return;
        } else noResults.classList.add('hidden');

        const sortedPosts = [...IG_POSTS].sort((a,b)=> new Date(b.date)-new Date(a.date));
        const groupedPosts = sortedPosts.reduce((acc, post)=>{
            if(!acc[post.region]) acc[post.region]=[];
            acc[post.region].push(post);
            return acc;
        }, {});

        regionsToRender.forEach(city=>{
            // æœå°‹æ™‚ä½¿ç”¨ filteredPostsï¼Œå¦å‰‡ä½¿ç”¨ groupedPosts
            const cityPosts = isSearch 
                ? filteredPosts.filter(p => p.region === city) 
                : groupedPosts[city] || [];

            const safeCityId = city.replace(/\s+/g,'-');
            const initialCount = isSearch ? cityPosts.length : Math.min(cityPosts.length, POSTS_PER_LOAD);
            const hasMore = cityPosts.length > initialCount;

            const citySection = document.createElement('section');
            citySection.id = safeCityId;
            citySection.className = 'city-section pt-10';
            citySection.innerHTML = `
                <h3 class="text-3xl font-extrabold text-pink mb-6 flex items-center border-b-2 border-pink pb-2">
                    ğŸ“Œ ${city} <span class="text-lg font-normal text-slate-500 ml-3">${cityPosts.length>0 ? `(${cityPosts.length} ç¯‡)`:'(å°šç„¡è²¼æ–‡)'}</span>
                </h3>
                <div id="grid-${safeCityId}" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-3 gap-6"></div>
                <div class="text-center mt-8">
                    ${cityPosts.length>0 && !isSearch ? `<button id="load-more-${safeCityId}" onclick="loadMore('${city}')" class="font-bold py-3 px-8 rounded-full shadow-lg transition duration-300 bg-blue hover:bg-blue text-white">${hasMore?`è¼‰å…¥æ›´å¤š (ç›®å‰å·²é¡¯ç¤º ${initialCount}/${cityPosts.length} ç¯‡)`:`å·²é¡¯ç¤ºå…¨éƒ¨ ${cityPosts.length} ç¯‡`}</button>` : ''}
                </div>
            `;
            postsContainer.appendChild(citySection);
            const gridContainer = citySection.querySelector('.grid');
            for(let i=0; i<initialCount; i++) gridContainer.insertAdjacentHTML('beforeend', createPostCard(cityPosts[i]));
            currentPostCounts[city] = initialCount;
        });

        if(window.instgrm) window.instgrm.Embeds.process();
    }

    window.filterPosts = function(query){
        const q = query.trim().toLowerCase();
        searchQueryDisplay.textContent = q;
        if(!q) return renderPosts(REGIONS);

        const filteredPosts = IG_POSTS.filter(p=>p.region.toLowerCase().includes(q) || p.content.toLowerCase().includes(q));
        const regionsToRender = [...new Set(filteredPosts.map(p=>p.region))];
        renderPosts(regionsToRender, true, filteredPosts); // å‚³å…¥ filteredPosts
    }

    window.loadMore = function(city){
        const cityPosts = IG_POSTS.filter(p=>p.region===city);
        const currentCount = currentPostCounts[city]||0;
        const gridContainer = document.getElementById(`grid-${city.replace(/\s/g,'-')}`);
        const loadMoreButton = document.getElementById(`load-more-${city.replace(/\s/g,'-')}`);
        if(!gridContainer||!loadMoreButton) return;
        const nextCount = Math.min(currentCount+POSTS_PER_LOAD,cityPosts.length);
        for(let i=currentCount;i<nextCount;i++) gridContainer.insertAdjacentHTML('beforeend', createPostCard(cityPosts[i]));
        currentPostCounts[city]=nextCount;
        if(nextCount>=cityPosts.length){
            loadMoreButton.textContent=`å·²é¡¯ç¤ºå…¨éƒ¨ ${cityPosts.length} ç¯‡è²¼æ–‡`;
            loadMoreButton.disabled=true;
            loadMoreButton.classList.add('bg-gray-300','cursor-not-allowed');
            loadMoreButton.classList.remove('bg-blue','hover:bg-blue');
        } else loadMoreButton.textContent=`è¼‰å…¥æ›´å¤š (ç›®å‰å·²é¡¯ç¤º ${nextCount}/${cityPosts.length} ç¯‡)`;
        if(window.instgrm) window.instgrm.Embeds.process();
    }

    function renderNavLists() {
        cityNavList.innerHTML = '';
        mobileNavList.innerHTML = '';
        REGIONS.forEach(region => {
            const liDesktop = document.createElement('li');
            liDesktop.innerHTML = `<a href="#${region.replace(/\s+/g,'-')}" class="block px-3 py-1 rounded hover:bg-blue-50 text-blue-600">
                ${region} (${IG_POSTS.filter(p => p.region === region).length})
            </a>`;
            cityNavList.appendChild(liDesktop);

            const liMobile = document.createElement('li');
            liMobile.innerHTML = `<a href="#${region.replace(/\s+/g,'-')}" class="px-3 py-1 rounded bg-blue-50 text-blue-600 whitespace-nowrap hover:bg-blue-100">${region}</a>`;
            mobileNavList.appendChild(liMobile);
        });
    }

    document.addEventListener('DOMContentLoaded',()=>{
        renderNavLists();
        renderPosts(REGIONS);
    });
</script>

</body>
</html>
